<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> RT-Forum </title>
    <link rel="shortcut icon" href="/css/img/chat.png">
    <link rel ="stylesheet" href="/css/home.css">
</head>

<body>
    <div id="Header">🅡🅔🅐🅛-🅣🅘🅜🅔-🅕🅞🅡🅤🅜</div>

    <nav class="nav">
        <a id ="homePage" href = "/" class="nav__link" data-link>HomePage</a>
        <a id ="register" onclick="openReg() ;"class="nav__link" data-link>Register</a>
        <a id ="login" onclick="openLogin() ;"class="nav__link" data-link>Login</a>
        <a id ="post" href = "/posts" class="nav__link" data-link>Posts</a>
        <a id="profile" href = "/profile" class="nav__link" data-link>Profile</a>    
        <a id="logout" onclick="DeleteSession() ;" href = "/" class="nav__link" style="display:none" data-link>LogOut</a>    

    </nav>

    <nav class="chat">
        <a id ="Chat Here" href = "/chat" class="chat__link" data-link>  Chat Here</a>
        <div id="log"></div>
        <form class="modal-content animate" action="/chat" id="formChat">
            <input type="submit" id="btn" value="Send" />
            <input type="text" id="msg" size="64" autofocus />
        </form>
    </nav>

    <nav class="loggedInUsers">
        <a id="Select User" class="loggedInUsers__link" data-link><strong>Chat Members</strong></a>
        <div id="usersLog">
          <!--<div style="color: rgb(128, 237, 153);"><a id="Select User" href = "/loggedInUsers" class="loggedInUsers__link" data-link>Arabella</a></div>
            <div style="color: rgb(128, 237, 153);"><a id="Select User" href = "/loggedInUsers" class="loggedInUsers__link" data-link>Duke Oton</a></div>-->
        
        </div>
    </nav>

    <div id="postBlock"class ="posts" >
        <label for="PostTitle">Post Title:</label>
        <textarea name="postTitle" type="text" rows="1" cols="60" id="PostTitle" name="Title" placeholder="Enter Title..."></textarea>
        <label for="Post Content"> Content:  </label>
        <textarea name="postinput" type="text" rows="4" cols="60" id="PostContent" name="Content" placeholder="Description..."></textarea>
        <label for="Post Cat">Catergory:</label>
        <input type="dropdown" id="PostCat" name="Category" placeholder="Choose Categories..">
        <button class="button postBtn" id="addPost" type="submit">Create Post</button>

    </div>


    <div id="loginModal" class="modal"> 
       
       <form class="modal-content animate" action="/login">
       <div class="imgcontainer">
        <img src="/css/img/user-group-man-woman.png" height="250px" width="300px" alt="Avatar" class="avatar">
       </div> 
      

       <div class="container" >
        <h1>🅛🅞🅖🅘🅝</h1>

        <label for="userName"><b>UserName</b></label>
        <input type="text" id="LUserName" placeholder="Enter Username" name="UserName" required>
        
        <label for="psw"><b>Password</b></label>
        <input type="password" id="LPassW" placeholder="Enter Password" name="psw" required>

        <button class="button" id="loginBtn" type="submit">Login</button>
        <label>
            <input type="checkbox" checked="checked" name="remember"> Remember Me
        </label>

        <button id="cancelbtn" type="button" onclick="document.getElementById('loginModal').style.display='none'; closeBtn()" class="button">Cancel</button>
        <span class="psw">New User Please👇 </span>

        <button type="button" onclick="openReg(); " class="button" href="/registration">Register</button>

       </div>
       </form>

    </div>

    <div id="regModal" class="modal">     
       
       <form class="modal-content animate" action="/register">
       <div class="imgcontainer">
        <img src="/css/img/user-group-man-woman.png" height="230px" width="290px" alt="Avatar" class="avatar">
       </div> 
       

       <div class="container" id="form"> 
        <h2>🅡🅔🅖🅘🅢🅣🅔🅡</h2>
        <label for="FirstName"><b>First Name</b></label>
        <input id="FirstName" type="text" placeholder="Enter First Name" name="FirstName" required>

        <label for="LastName"><b>Last Name</b></label>
        <input id="LastName" type="text" placeholder="Enter Last Name" name="Last Name" required>

        <label for="NickName"><b>NickName</b></label>
        <input id="NickName" type="text" placeholder="This will be your userName" name="Nick Name" required  minlength="4" maxlength="10">

        <label for="Age"><b>Age</b></label>
        <input id="Age" type="number" placeholder="Enter Age" name="Age" required>

        <label  for="Gender"><b>Gender</b></label>
        <input id="Gender" type="text" placeholder="Enter Gender" name="Gender" required>
    
        <label for="Email"><b>Email</b></label>
        <input id="Email" type="email" onkeydown="validation()" size="30" placeholder="Enter Email Address" name="Email" required>
        <span id="text"></span>

        <label for="psw"><b>Password</b></label>
        <input id="PassWord" type="password" placeholder="Enter Password" name="psw" required>

        
      <span>
        <button class="button1" id="registerBtn" type="submit">Register</button>
        
        <button id="cancelbtn" type="button" onclick="document.getElementById('regModal').style.display='none'; closeBtn()" class="button1">Cancel</button>
       
      </span>
       

        

       </div>
    </form>
    </div>


    <div id="regConfirmed" style="display:none">
        <h4>
            You're are now Registered
        </h4>
    </div>

    <div id="regRejected" style="display:none">
        <h4>
            Sorry Error with registration
        </h4>
    </div>
    <div id="LoggedOn" style="display:none">
        <h4>
            You're are Logged in.
        </h4>
    </div>
    <button onclick="refreshPosts()">Refresh Posts</button>
    <div id="postList">
    </div>
    <!---->

<!--<script src='/js/Login.js'></script>-->
<!--Adding JS for the chat here as js/chat.js not working-->
    <script type="text/javascript">
        window.onload = function () {
            var conn;
            var pst = document.getElementById("postList");
            var msg = document.getElementById("msg");
            var log = document.getElementById("log");
            var usersLog = document.getElementById("usersLog");

        
            function appendLog(item) {
                var doScroll = log.scrollTop > log.scrollHeight - log.clientHeight - 1;
                log.appendChild(item);
                if (doScroll) {
                    log.scrollTop = log.scrollHeight - log.clientHeight;
                }
            }

            function AppendUser(item) {
            var doScroll = usersLog.scrollTop > usersLog.scrollHeight - usersLog.clientHeight - 1;
            item.style.color = 'white'
            usersLog.appendChild(item);
            if (doScroll) {
                usersLog.scrollTop = usersLog.scrollHeight - usersLog.clientHeight;
            }
        }

        function AppendPosts(item){
            var doScroll = pst.scrollTop > pst.scrollHeight - pst.clientHeight - 1;
            item.style.color = 'white'
            pst.appendChild(item);
            if (doScroll) {
                pst.scrollTop = pst.scrollHeight - pst.clientHeight;
            }
        }
        
            document.getElementById("formChat").onsubmit = function () {
                if (!conn) {
                    return false;
                }
                if (!msg.value) {
                    return false;
                }
                conn.send(msg.value);
                msg.value = "";
                return false;
            };
        
            if (window["WebSocket"]) {
                conn = new WebSocket("ws://" + document.location.host + "/ws");
                conn.onclose = function (evt) {
                    var item = document.createElement("div");
                    item.innerHTML = "<b>Connection closed.</b>";
                    appendLog(item);
                };

                conn.onmessage = function (evt) {
                    var messages = evt.data.split('\n');
                    for (var i = 0; i < messages.length; i++) {
                        var item = document.createElement("div");
                        item.style.color = '#80ed99'
                        item.innerText = messages[i];
                        //if message is a list of chat members, it begins with a space
                        if (messages[0] == " "){
                            if(i < messages.length){
                            item.innerText = messages[i]
                            //print list inside 'usersLog' div
                            AppendUser(item);
                            }
                        //the list of posts starts with a double space
                        }else if(messages[0] == "  "){
                                //append all posts at end of main page
                                item.innerText = messages[i]
                            //append posts inside in the main window
                            AppendPosts(item);
                        }else{   
                            //print list inside 'log' div                   
                            appendLog(item);
                        }
                };

        };

            } else {
                var item = document.createElement("div");
                item.innerHTML = "<b>Your browser does not support WebSockets.</b>";
                appendLog(item);
            }
        };

        // by Kingsley: Concatenates the user's details within the HTML after login
/*function updateUserDetails(data) {
  console.log(
    "updated User Details",
    data.User.firstName,
    data.User.lastName,
    data.User.username
  );
  document.querySelector("p.name").innerHTML =
    data.User.firstName +   + data.User.lastName;
  document.querySelector("p.username").innerHTML = @ + data.User.username;
  document.querySelector("#postBody").placeholder =
    What's new,  + data.User.firstName + ?;
}*/
        </script>
</body>
<!-- this script runs register/login/chat modal -->
<script src="/js/comments.js"></script>
<script src="/js/post.js"></script>
<script src="/js/register.js"></script>
<script src="/js/login.js"></script>
<script src="/js/buttons.js"></script>
<!--<script src="/js/chat.js"></script>-->

</html>